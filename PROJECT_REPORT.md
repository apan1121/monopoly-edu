# 🎲 大富翁教學遊戲 - 專案結案報告

## 📋 專案概述

**專案名稱：** 大富翁教學遊戲
**開發時間：** 2025年
**專案類型：** 單頁網頁應用程式 (Single Page Application)
**技術堆疊：** HTML5, CSS3, JavaScript (Vanilla JS)
**專案目的：** 開發一款適合課堂教學使用的大富翁遊戲，讓學生透過遊戲完成現實任務並計分

---

## 🎯 核心功能

### 1. 遊戲設定系統
- **棋盤格子數量設定**：支援 20-50 格可調整棋盤
- **玩家數量設定**：支援 2-6 位玩家
- **玩家客製化**：
  - 自訂玩家名稱
  - 30 種鮮豔顏色可選擇
  - 顏色選擇器介面
- **任務系統設定**：
  - 可設定 1-20 個任務
  - 任務內容最多 100 字
  - 任務成功分數可調整
  - 預設提供 25 個範例任務
- **隱藏模式**：格子在玩家走過前顯示迷霧遮蓋

### 2. 遊戲棋盤
- **蛇形排列**：棋盤採用蛇形路徑設計
  - 第 1 行：從左到右
  - 第 2 行：從右到左
  - 第 3 行：從左到右
  - 以此類推
- **響應式佈局**：
  - 桌面版：根據格子數量自動計算最佳列數
  - 手機版：固定 4 列避免爆版
  - 視窗大小改變時自動調整
- **格子類型**：
  - 起點（綠色）：所有玩家起始位置
  - 終點（橘色）：遊戲結束點
  - 任務格（漸層色 + 📋 圖示）：隨機分配任務
  - 普通格（藍色）：無特殊功能
- **視覺效果**：
  - 格子 hover 效果
  - 當前玩家所在格子金色光暈動畫
  - 玩家 token 顯示名稱首字
  - 玩家 token 彈跳動畫

### 3. 骰子系統
- **3D 骰子動畫**：
  - 六面骰子立方體 CSS 3D 轉換
  - 正確的點數排列（1-6）
  - 滾動動畫 0.6 秒
  - 真實隨機數產生
- **骰子統計功能**：
  - 記錄每個點數出現次數
  - 控制台輸出統計資料
  - 方便驗證隨機性

### 4. 遊戲控制介面
- **側邊欄設計**：
  - 浮動按鈕（右下角）
  - 側滑動畫展開/收合
  - 遮罩層點擊關閉
- **骰子控制區（固定不滾動）**：
  - 骰子顯示與點擊擲骰
  - 當前輪到玩家提示
  - 遊戲控制標題
- **玩家狀態區（可滾動）**：
  - 顯示所有玩家資訊
  - 當前玩家黃色高亮
  - 即時分數更新
  - 打開側邊欄自動滾動到當前玩家

### 5. 玩家移動系統
- **逐格移動動畫**：每 0.3 秒移動一格
- **自動視角追蹤**：
  - 開始遊戲時滾動到起點
  - 擲骰後自動滾動到當前玩家位置
  - 移動時棋盤置中顯示
- **迷霧移除**：隱藏模式下，玩家經過的格子會移除迷霧（不需停留）

### 6. 任務系統
- **任務彈窗**：
  - 顯示當前玩家名稱
  - 顯示任務內容
  - 完成/失敗按鈕
- **任務分配**：隨機分配到非起點終點的格子
- **任務計分**：
  - 完成任務：獲得設定的分數
  - 失敗任務：不得分
- **LocalStorage 持久化**：任務內容自動儲存

### 7. 匯入/匯出功能
- **匯出設定**：
  - 包含所有遊戲設定
  - 包含任務列表
  - 包含隱藏模式設定
  - JSON 格式檔案
  - 自動命名檔案（含日期）
- **匯入設定**：
  - 讀取 JSON 設定檔
  - 自動填入所有欄位
  - 格式驗證

### 8. 遊戲結束與計分
- **觸發條件**：任一玩家到達終點
- **計分板顯示**：
  - 冠軍動畫效果
  - 前三名特殊視覺效果（金銀銅）
  - 顯示所有玩家排名
  - 顯示玩家顏色與分數
- **重新開始**：一鍵重新載入遊戲

---

## 🎨 設計特色

### 視覺設計
- **色彩豐富**：漸層背景、多彩格子、30 種玩家顏色
- **動畫流暢**：
  - 骰子 3D 滾動
  - 玩家 token 彈跳
  - 格子 hover 效果
  - 側邊欄滑動
  - 標題彈跳動畫
  - 迷霧呼吸動畫
- **表情符號運用**：🎲 🏠 🏁 📋 ✅ ❌ 🏆 等增加親和力

### 使用者體驗
- **直覺操作**：
  - 點擊骰子擲骰
  - 浮動按鈕開啟控制面板
  - 自動視角追蹤
  - 自動關閉側邊欄
- **回饋明確**：
  - 當前玩家高亮顯示
  - 格子編號標示
  - 輪到誰的文字提示
  - 動畫效果提示狀態變化
- **響應式設計**：
  - 桌面、平板、手機皆可使用
  - 自動調整棋盤佈局
  - 手機版優化（4 列）

---

## 📁 檔案結構

```
/Users/apan1121/workspace/DockerPP_V2/pp_app/web/game/
└── game.html (1,760 行)
    ├── CSS 樣式 (約 850 行)
    │   ├── 基礎樣式
    │   ├── 設定頁面樣式
    │   ├── 遊戲頁面樣式
    │   ├── 棋盤樣式
    │   ├── 骰子 3D 樣式
    │   ├── 側邊欄樣式
    │   ├── 任務彈窗樣式
    │   ├── 結果頁面樣式
    │   └── 響應式設計
    ├── HTML 結構 (約 150 行)
    │   ├── 設定頁面
    │   ├── 遊戲頁面
    │   ├── 任務彈窗
    │   └── 結果頁面
    └── JavaScript 程式邏輯 (約 760 行)
        ├── 遊戲狀態管理
        ├── 玩家設定產生
        ├── 顏色選擇器
        ├── 任務管理與持久化
        ├── 棋盤初始化與渲染
        ├── 蛇形排列演算法
        ├── 3D 骰子創建與旋轉
        ├── 玩家移動邏輯
        ├── 任務系統
        ├── 計分系統
        ├── 匯入/匯出功能
        ├── 側邊欄控制
        ├── 視角追蹤
        └── 初始化與事件監聽
```

---

## 🔧 技術細節

### 核心演算法

#### 1. 蛇形排列演算法
```javascript
// 計算行列數
const cols = isMobile ? 4 : Math.ceil(Math.sqrt(cellCount));
const rows = Math.ceil(cellCount / cols);

// 蛇形排列
for (let row = rows - 1; row >= 0; row--) {
  if ((rows - 1 - row) % 2 === 0) {
    // 從左到右
    for (let col = 0; col < cols; col++) { ... }
  } else {
    // 從右到左
    for (let col = cols - 1; col >= 0; col--) { ... }
  }
}

// 處理不完整行的對齊
if (isLastRowIncomplete && !isRightToLeft) {
  div.style.gridColumnStart = cols - cellsInLastRow + col + 1;
}
```

#### 2. 骰子旋轉對應
```javascript
const rotations = {
  1: 'rotateX(0deg) rotateY(0deg)',
  2: 'rotateX(90deg) rotateY(0deg)',
  3: 'rotateX(0deg) rotateY(-90deg)',
  4: 'rotateX(0deg) rotateY(90deg)',
  5: 'rotateX(-90deg) rotateY(0deg)',
  6: 'rotateX(0deg) rotateY(180deg)'
};
```

#### 3. 迷霧系統
- 使用 `Set` 資料結構追蹤已訪問格子
- CSS `::before` 偽元素實現迷霧視覺效果
- 玩家移動時動態更新 `visitedCells`

### CSS 技術

#### 1. 3D 骰子
- `transform-style: preserve-3d`
- `perspective: 1000px`
- 六面體各面位置定位
- Grid 佈局實現點數排列

#### 2. 響應式設計
- `@media (max-width: 768px)` 手機適配
- Flexbox 佈局側邊欄
- CSS Grid 佈局棋盤
- `aspect-ratio: 1` 保持格子正方形

#### 3. 動畫效果
- `@keyframes` 定義動畫
- `transition` 平滑過渡
- `animation` 循環動畫

### JavaScript 技術

#### 1. 狀態管理
- 全域變數管理遊戲狀態
- `gameConfig` 物件儲存設定
- `players` 陣列管理玩家資料
- `board` 陣列表示棋盤狀態

#### 2. LocalStorage
- 任務內容持久化
- 自動儲存與載入
- JSON 序列化/反序列化

#### 3. 事件處理
- 點擊事件
- 檔案上傳事件
- 視窗大小改變事件（防抖處理）
- 動態事件綁定

---

## 🐛 問題解決紀錄

### 1. 骰子點數顯示錯誤
**問題：** 骰子各面點數排列不正確
**解決：** 調整 CSS Grid 佈局，只修改 `faces` 陣列，保持 `rotations` 不變

### 2. 側邊欄位置錯誤
**問題：** 響應式 CSS 導致側邊欄顯示在棋盤下方
**解決：** 移除 `@media` 中將 `position: fixed` 改為 `relative` 的設定

### 3. 側邊欄滾動問題
**問題：** 玩家列表過長時，骰子區塊也會被滾動遮蔽
**解決：** 將側邊欄改為 Flexbox 佈局，分為固定區域和可滾動區域

### 4. 手機版棋盤爆版
**問題：** 30 格在手機上排成 6 列太擠
**解決：** 偵測螢幕寬度，手機版固定 4 列，並加入視窗大小改變監聽

### 5. 蛇形排列不完整行對齊
**問題：** 10 格在 4 列時，最後 2 格應靠右但靠左了
**解決：** 計算不完整行的格子數，使用 `gridColumnStart` 調整位置

### 6. 玩家位置追蹤
**問題：** 擲骰後看不到玩家移動到哪裡
**解決：** 實作 `scrollToCurrentPlayer()` 函數，使用 `scrollIntoView` API

### 7. 側邊欄打開時找不到當前玩家
**問題：** 玩家列表太長，打開側邊欄時當前玩家不在可見範圍
**解決：** 在 `toggleSidebar()` 中加入延遲，等動畫完成後滾動到當前玩家

---

## 📊 遊戲流程圖

```
開始
  ↓
[設定頁面]
  - 設定棋盤格子數
  - 設定玩家數量與名稱
  - 設定任務數量與內容
  - 設定隱藏模式
  - 匯入/匯出設定
  ↓
點擊「開始遊戲」
  ↓
[遊戲頁面]
  - 初始化棋盤
  - 所有玩家在起點
  - 隱藏模式下顯示迷霧
  - 滾動到起點位置
  ↓
[玩家回合循環]
  - 點擊浮動按鈕 → 打開側邊欄
  - 自動滾動到當前玩家
  - 點擊骰子擲骰
  - 骰子動畫（0.6秒）
  - 關閉側邊欄
  - 滾動到當前玩家位置
  - 玩家逐格移動（0.3秒/格）
  - 移除經過格子的迷霧
  ↓
到達格子
  ↓
是任務格？
  ├─ 是 → 顯示任務彈窗
  │         ↓
  │      選擇完成/失敗
  │         ↓
  │      更新分數
  │         ↓
  │      下一位玩家
  │
  └─ 否 → 下一位玩家
  ↓
是否有玩家到達終點？
  ├─ 否 → 回到[玩家回合循環]
  │
  └─ 是 → [結果頁面]
           - 計算排名
           - 顯示冠軍
           - 顯示計分板
           - 重新開始按鈕
```

---

## 🎓 教學應用場景

### 適用科目
- **體育課**：體能訓練任務（深蹲、跳繩、伏地挺身）
- **英文課**：英文單字、句型練習
- **數學課**：口算題、九九乘法表
- **音樂課**：唱歌、樂器演奏
- **綜合活動**：團隊建立、表達訓練

### 教學優勢
1. **寓教於樂**：透過遊戲提升學習動機
2. **公平競爭**：骰子隨機性確保公平
3. **即時回饋**：任務完成立即得分
4. **可重複使用**：設定可匯出分享
5. **彈性調整**：任務與難度可自訂
6. **適合分組**：支援 2-6 人遊戲

### 使用建議
1. **課前準備**：
   - 預先設定好任務內容
   - 匯出設定檔備份
   - 測試所有任務可行性

2. **課堂執行**：
   - 投影到大螢幕
   - 學生輪流操作
   - 老師當裁判判定任務完成

3. **課後延伸**：
   - 檢討任務完成情況
   - 分享遊戲設定檔
   - 讓學生自己設計任務

---

## 📈 效能優化

### 已實作優化
1. **防抖處理**：視窗大小改變事件使用 300ms 防抖
2. **條件渲染**：只在遊戲進行中重新渲染棋盤
3. **CSS 動畫**：使用 CSS transition 而非 JavaScript 動畫
4. **LocalStorage**：僅儲存必要資料
5. **事件委派**：顏色選擇器使用事件委派

### 可改進項目
1. 大量玩家時的效能優化（目前限制 6 人）
2. 複雜動畫的 GPU 加速
3. 圖片/資源延遲載入（目前無外部資源）

---

## 🌐 瀏覽器相容性

### 支援瀏覽器
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

### 所需功能
- CSS Grid
- CSS 3D Transforms
- ES6 JavaScript (let/const, arrow functions, template literals)
- LocalStorage
- FileReader API
- Blob API

---

## 📱 響應式斷點

- **桌面版**：> 768px
  - 棋盤：自動計算最佳列數
  - 側邊欄：300px 寬

- **手機版**：≤ 768px
  - 棋盤：固定 4 列
  - 標題字體縮小
  - 浮動按鈕略小

---

## 🔮 未來擴充建議

### 功能面
1. **音效系統**：
   - 擲骰子音效
   - 移動音效
   - 完成任務音效
   - 背景音樂

2. **特殊格子**：
   - 機會格：隨機事件
   - 命運格：特殊效果
   - 傳送格：跳到其他位置
   - 陷阱格：扣分或後退

3. **道具系統**：
   - 加速道具：多走幾步
   - 免疫道具：跳過任務
   - 雙倍道具：分數加倍

4. **多種遊戲模式**：
   - 限時模式
   - 積分達標模式
   - 團隊合作模式

5. **成就系統**：
   - 連續完成任務
   - 首位到達終點
   - 完美通關

### 技術面
1. **資料視覺化**：
   - 遊戲歷程圖表
   - 骰子統計圖表
   - 玩家表現分析

2. **多人線上**：
   - WebSocket 即時對戰
   - 房間系統
   - 聊天功能

3. **資料庫整合**：
   - 儲存遊戲紀錄
   - 排行榜系統
   - 歷史對局查詢

4. **PWA 支援**：
   - 離線可用
   - 安裝到桌面
   - 推播通知

---

## 👥 開發團隊

- **開發者**：Claude (Anthropic AI Assistant)
- **專案所有者**：apan1121
- **開發模式**：協作對話式開發

---

## 📝 授權資訊

此專案為教育用途開發，建議採用 MIT License 或 CC BY-NC-SA 4.0

---

## 🙏 致謝

感謝在開發過程中的：
- 使用者即時回饋與需求提供
- 反覆測試與問題回報
- 創意發想與功能建議

---

## 📞 聯絡資訊

**專案位置：** `/Users/apan1121/workspace/DockerPP_V2/pp_app/web/game/game.html`

---

**報告日期：** 2025-11-30
**最終版本：** v1.0
**總開發時間：** 1 次完整開發會話
**程式碼總行數：** 1,760 行

---

## 🎉 專案總結

此大富翁教學遊戲成功達成了所有預期目標：

✅ 完整的遊戲機制
✅ 豐富的視覺效果
✅ 流暢的使用體驗
✅ 響應式設計支援
✅ 教學情境適用
✅ 設定匯入/匯出
✅ 資料持久化
✅ 隱藏模式增加趣味性

專案採用單檔案架構，便於部署與分享，只需開啟瀏覽器即可使用，非常適合教學現場使用。透過豐富的動畫效果與直覺的操作介面，能夠有效提升學生的學習興趣與參與度。
